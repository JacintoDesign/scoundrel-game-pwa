/* CSS Variables and Base Styles */
:root {
  --bg: #0e0f12;
  --panel: #151618;
  --text: #eceff2;
  --muted: #a5acb4;
  --primary: #6ee7b7;
  --primary-600: #34d399;
  --danger: #f87171;
  --accent: #7aa2ff;
  --monster: #9aa2ad;
  --weapon: #fbbf24;
  --potion: #fb7185;
  --club: #818cf8; /* indigo */
  --spade: #818cf8; /* indigo */
  --diamond: #f59e0b; /* yellow */
  --heart: #ef4444;
  --card: #17191c;
  --card-border: #25282d;
  --success: #86efac;
  --focus: #f59e0b;
  --shadow: 0 10px 30px rgba(0,0,0,0.35);
}

* { box-sizing: border-box; }
html, body { height: 100%; }
body {
  margin: 0;
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
  background: radial-gradient(1200px 600px at 70% 0%, #131416 0%, var(--bg) 60%);
  color: var(--text);
}

.visually-hidden { position: absolute !important; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0,0,0,0); white-space: nowrap; border: 0; }

.app-header {
  display: flex; align-items: center; justify-content: space-between;
  padding: 16px clamp(16px, 4vw, 32px);
  background: transparent; border-bottom: 1px solid rgba(255,255,255,0.06);
  position: sticky; top: 0; width: 100%;
}
.app-title { font-size: clamp(24px, 3vw, 32px); letter-spacing: 0.5px; margin: 0; }
.controls { display: flex; gap: 8px; }
/* Hide the mobile toggle by default (desktop) */
.toggle-controls { display: none; }

.btn {
  background: #222b3a; color: var(--text);
  border: 1px solid #2c3547; border-radius: 10px;
  padding: 10px 14px; cursor: pointer;
  transition: transform .06s ease, background .2s ease, border-color .2s ease, box-shadow .2s ease;
}
.btn:hover { background: #283346; border-color: #37445c; }
.btn:active { transform: translateY(1px); }
.btn.primary { background: linear-gradient(180deg, var(--primary) 0%, var(--primary-600) 100%); color: #032018; border: none; }
.btn.danger { background: linear-gradient(180deg, #ef6b6b 0%, #d94f4f 100%); color: #2a0909; border: 1px solid #b63e3e; }
.btn.danger:hover { background: linear-gradient(180deg, #f07a7a 0%, #df5a5a 100%); border-color: #c24747; }
.btn.danger[disabled] { opacity: 0.6; cursor: not-allowed; }
.btn[disabled] { opacity: 0.6; cursor: not-allowed; }
.btn:focus-visible { outline: 3px solid var(--focus); outline-offset: 2px; }

.layout { max-width: 1100px; margin: 0 auto; padding: 16px clamp(16px, 4vw, 32px); display: grid; gap: 16px; }

.hud {
  display: grid;
  grid-template-columns: 1fr repeat(4, max-content) 1fr;
  align-items: end; gap: 12px; padding: 12px; border: 1px solid rgba(255,255,255,0.06); border-radius: 14px; background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0));
}
.hud .meter label { display: block; color: var(--muted); font-size: 12px; margin-bottom: 6px; }
.health-wrapper { position: relative; height: 24px; background: #141517; border-radius: 999px; border: 1px solid #292b2f; overflow: hidden; }
.health { position: absolute; top: 0; left: 0; height: 100%; width: 100%; background: linear-gradient(90deg, var(--success), var(--primary)); box-shadow: inset 0 0 10px rgba(0,0,0,0.45); }
.health-text { position: absolute; inset: 0; display: grid; place-items: center; font-weight: 600; color: #ffffff; padding: 0 12px; line-height: 1.2; }

.panel { background: #272727; border: 1px solid #3b3b3b; padding: 8px 12px; border-radius: 12px; min-width: 100px; }
.panel-title { color: var(--muted); font-size: 12px; }
.panel-body { font-size: 16px; font-weight: 600; display: flex; align-items: center; gap: 6px; }
.panel .divider { color: #4b5563; }

.actions { display: flex; justify-content: flex-end; }

.room { display: grid; gap: 12px; }
.room-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
@media (min-width: 720px) { .room-grid { grid-template-columns: repeat(4, 1fr); } }
.room-actions { text-align: center; color: var(--muted); display: flex; flex-direction: column; align-items: center; gap: 8px; }
.room-actions .btn { margin: 0 4px; padding-left: 5px; padding-right: 5px; }
.room-actions .hint { margin: 8px 0 0; }

.card {
  position: relative; height: 140px; border-radius: 16px; background: var(--card); border: 1px solid var(--card-border); overflow: hidden; cursor: pointer; user-select: none;
  box-shadow: var(--shadow);
  transition: transform .15s ease, box-shadow .2s ease, border-color .2s ease;
  perspective: 1000px;
}
.card .art { position: absolute; inset: 0; background-size: cover; background-position: center; filter: saturate(0.9) contrast(1.05); opacity: 0.8; pointer-events: none; }
.card.placeholder .art { opacity: 0.3; filter: saturate(0.7) contrast(1); }
.card:hover { transform: translateY(-2px); box-shadow: 0 16px 40px rgba(0,0,0,0.4); }
.card:focus-visible { outline: 3px solid var(--focus); outline-offset: 2px; }
.card-inner { position: absolute; inset: 0; display: grid; grid-template-rows: auto 1fr auto; padding: 10px; }
.card .suit { font-size: 18px; justify-self: start; align-self: start; }
.card .value { font-size: 28px; font-weight: 800; justify-self: start; align-self: start; }
.card .badge { position: absolute; top: 8px; right: 8px; padding: 4px 8px; font-size: 12px; border-radius: 999px; border: 1px solid rgba(255,255,255,0.1); }
.card.weapon { border-color: var(--weapon); }
.card.potion { border-color: var(--potion); }
.card.monster { border-color: var(--monster); }
.card.club .suit { color: var(--club); -webkit-text-stroke: 0px transparent; }
.card.spade .suit { color: var(--spade); -webkit-text-stroke: 0px transparent; }
.card.diamond .suit { color: var(--diamond); -webkit-text-stroke: 0px transparent; }
.card.heart .suit { color: var(--heart); }
.card.disabled { opacity: 0.5; cursor: not-allowed; }
.card.selected { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(110,231,183,0.2) inset; }

/* Mini card used in end modal */
.card.mini { width: 240px; height: 320px; cursor: default; }
.card.mini .card-inner { padding: 8px; }
.card.mini .suit { font-size: 16px; }
.card.mini .value { font-size: 22px; }
.end-killer { display: grid; gap: 8px; justify-items: center; margin-top: 8px; }

/* Flip animation */
@media (prefers-reduced-motion: no-preference) {
  /* Start flipped to show the back and rotate to front */
  .card .flip { position: absolute; inset: 0; transform-style: preserve-3d; }
  .card .face { position: absolute; inset: 0; backface-visibility: hidden; }
  .card .face.back { transform: rotateY(180deg); }
  .card.flip-enter .flip { transform: rotateY(180deg) scale(0.98); }
  .card.flip-enter-active .flip { transform: rotateY(0deg) scale(1); transition: transform 720ms ease; }
}

/* Desktop: cards use a vertical 3:4 aspect ratio */
@media (min-width: 720px) {
  .room-grid .card { height: auto; aspect-ratio: 3 / 4; }
  /* Desktop: align actions under cards 2 and 3, one button per card width */
  .room-actions { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; align-items: stretch; justify-items: stretch; text-align: initial; }
  .room-actions .btn { width: 100%; margin: 0; }
  .room-actions .btn.primary { grid-column: 2; }
  .room-actions .btn.danger { grid-column: 3; }
  .room-actions .hint { grid-column: 1 / -1; margin: 0; text-align: center; }
}

/* Square-ish aspect (not mobile portrait, not 16:9 wide) â€” let Health take all remaining width */
@media (min-width: 720px) and (min-aspect-ratio: 1/1) and (max-aspect-ratio: 5/4) {
  .hud { grid-template-columns: 1fr repeat(4, max-content); }
  .hud .actions { display: none; }
}

/* Mobile layout tweaks */
@media (max-width: 719px) {
  /* Header: put controls on a new row under the title */
  .app-header { position: relative; flex-direction: column; align-items: flex-start; gap: 8px; }
  .controls { width: 100%; flex-wrap: wrap; display: none; overflow: visible; }
  /* Stronger selector so toggle reliably shows on mobile */
  #topControls.open { display: flex !important; width: 100%; }
  .toggle-controls { display: inline-flex; align-items: center; justify-content: center; font-size: 14px; padding: 8px 14px; position: absolute; top: 12px; right: 16px; }

  /* HUD: health meter gets its own full row; other panels flow in 2 columns */
  .hud { grid-template-columns: max-content 1fr 1fr 1fr; align-items: start; }
  .hud .meter { grid-column: 1 / -1; }
  .hud .actions { grid-column: 1 / -1; justify-content: flex-start; }
  /* Allow panels to shrink so four fit on one row without horizontal scroll */
  .hud .panel { min-width: 0; }
  /* Keep weapon info on one line and let its column size to content */
  #weaponPanel .panel-body { white-space: nowrap; }

  /* Cards: taller vertical aspect similar to desktop */
  .room-grid .card { height: auto; aspect-ratio: 3 / 4; max-height: 260px; }

  /* Room actions: buttons on one row, hint on the line below */
  .room-actions { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; align-items: stretch; }
  .room-actions .btn { width: 100%; margin: 0 !important; }
  .room-actions .hint { grid-column: 1 / -1; margin-top: 0; }
}

/* Log */
.log-feed { max-height: 220px; overflow: auto; border: 1px solid rgba(255,255,255,0.06); border-radius: 12px; padding: 12px; background: #272727; text-align: left; }
.log-feed p { margin: 6px 0; font-size: 14px; }
.log-feed .good { color: var(--primary); }
.log-feed .bad { color: var(--danger); }
.log-feed .info { color: var(--muted); }
.log-feed .turn { color: #cbd5e1; opacity: 0.9; font-weight: 700; margin-top: 12px; padding-top: 8px; border-top: 1px dashed rgba(255,255,255,0.08); }

/* Desktop scrollbar styling for the log */
@media (min-width: 720px) {
  .log-feed { scrollbar-width: thin; scrollbar-color: #3a3d42 transparent; }
  .log-feed::-webkit-scrollbar { width: 12px; height: 12px; }
  .log-feed::-webkit-scrollbar-track {
    background: transparent;
    border-radius: 999px;
    margin: 2px; /* inset the track slightly for a mac-like channel */
  }
  .log-feed::-webkit-scrollbar-thumb {
    background: #3a3d42;
    border-radius: 999px; /* fully rounded */
    min-height: 32px; /* comfortable handle size */
    border: 3px solid transparent; /* create inner rounding via background-clip */
    background-clip: padding-box;
  }
  .log-feed::-webkit-scrollbar-thumb:hover { background: #4a4e54; }
  .log-feed::-webkit-scrollbar-corner { background: transparent; }
}

/* Dialogs */
dialog { border: none; border-radius: 12px; padding: 0; background: #242424; color: var(--text); box-shadow: var(--shadow); max-width: min(960px, 96vw); }
.dialog-open::backdrop, dialog::backdrop { background: rgba(0,0,0,0.55); }
dialog .modal-body { padding: 16px; }
dialog .modal-actions { display: flex; justify-content: flex-end; gap: 8px; padding: 16px; border-top: 1px solid rgba(255,255,255,0.06); }
dialog h2, dialog h3 { margin: 16px; }
#endModal #endTitle { margin-bottom: 0; text-align: center; }
#endModal .modal-body { padding-top: 0; }
#endModal h3.score { margin-top: 0; text-align: center; }
#endModal #endSummary { text-align: center; }
#helpModal h2 { text-align: left; }
#helpModal h3 { text-align: left; margin-left: 0; }
/* Tighten spacing in Help modal like End modal */
#helpModal #helpTitle { margin-bottom: 0; }
#helpModal .modal-body { padding-top: 0; }
dialog .small { color: var(--muted); font-size: 13px; margin: 0 16px 16px; }

/* Focus outlines on focusable elements in cards */
.card [tabindex="0"], .card button, .card a { outline: none; }

/* Utility */
.mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
.hidden { display: none !important; }
